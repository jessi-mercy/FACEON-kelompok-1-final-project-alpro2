{% extends "base.html" %}

{% block title %}Results - faceon{% endblock %}

{% block content %}
<section class="result-section">
    <div class="container">
        <div class="result-header">
            <h1>RESULTS.</h1>
        </div>

        <div class="result-card">
            <div class="result-content">
                
                <!-- 1. BAGIAN FOTO WAJAH -->
                <div class="face-display">
                    <div class="face-label">FACE</div>
                    <!-- PERUBAHAN PENTING: Menggunakan variabel langsung, bukan request.args -->
                    {% if image_url %}
                        <img src="{{ image_url }}" alt="Detected Face" class="face-image">
                    {% else %}
                        <div class="face-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                    
                    <div class="emotion-summary">
                        {% set confidence_percent = (confidence * 100) | round(1) %}
                        
                        Emotion of this detected face is most likely to be 
                        <strong style="text-transform: uppercase; color: #FF5722;">{{ emotion }}</strong>, 
                        with the highest possibility of <strong>{{ confidence_percent }}%</strong>.
                    </div>
                </div>

                <!-- 2. BAGIAN PROGRESS BAR -->
                <div class="emotion-breakdown">
                    <h3>Emotion Analysis</h3>
                    <div class="emotion-list">
                        
                        <!-- List kunci emosi (sesuai output model) -->
                        {% set keys = ['angry', 'disgust', 'fear', 'happy', 'neutral', 'sad', 'surprise'] %}
                        
                        <!-- Looping untuk setiap emosi -->
                        {% for key in keys %}
                            <!-- Ambil nilai dari all_predictions -->
                            {% set val = all_predictions.get(key, 0) %}
                            {% set percent = (val * 100) | round(1) %}
                            {% set is_winner = (key == emotion) %}
                            {% set bar_color = '#FF5722' if is_winner else '#4CAF50' %}
                            
                            <div class="emotion-item-breakdown" style="display: flex; align-items: center; margin-bottom: 10px;">
                                <!-- Label Emosi -->
                                <div class="emotion-label" style="width: 80px; font-weight: bold; text-transform: uppercase;">
                                    {{ key }}
                                </div>
                                
                                <!-- Batang Bar -->
                                <div class="emotion-bar-container" style="flex-grow: 1; background: #eee; height: 12px; margin: 0 15px; border-radius: 6px; overflow: hidden;">
                                    <div class="emotion-bar" style="
                                        width: {{ percent }}%; 
                                        height: 100%; 
                                        background-color: {{ bar_color }};
                                        transition: width 0.6s ease-in-out;">
                                    </div>
                                </div>
                                
                                <!-- Angka Persentase -->
                                <div class="emotion-percentage" style="width: 50px; text-align: right; font-size: 0.9em;">
                                    {{ percent }}%
                                </div>
                            </div>
                        {% endfor %}

                    </div>
                </div>
            </div>
            
            <div class="result-actions">
                <!-- Ganti 'upload_page' dengan 'upload_page' atau 'index' sesuai nama fungsi di app.py -->
                <a href="{{ url_for('upload_page') }}" class="btn btn-primary">TRY AGAIN</a>
            </div>
        </div>
    </div>
</section>
{% endblock %}